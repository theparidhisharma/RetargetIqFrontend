<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetargetIQ Demo</title>
    
    <!-- 1. Load Tailwind CSS (for styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load React & ReactDOM (for the app logic) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Load Babel (to process the React code in the browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Styles -->
    <style>
        body { background-color: #f9fafb; }
        /* Smooth animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 5. The Application Code -->
    <script type="text/babel">
        const { useState } = React;

        // --- Icons (Inlined for portability) ---
        const Activity = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const Server = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>;
        const Database = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>;
        const AlertCircle = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;

        // --- Main Component ---
        function RecommendUI() {
            const [userId, setUserId] = useState('user-123');
            const [k, setK] = useState(5);
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);

            const callRecommend = async () => {
                setLoading(true);
                setError(null);
                setResult(null);

                try {
                    // SIMULATION: Fake network delay
                    await new Promise(resolve => setTimeout(resolve, 800));

                    // SIMULATION: Mock Response
                    const mockResponse = {
                        meta: {
                            request_id: "req_" + Math.random().toString(36).substr(2, 9),
                            timestamp: new Date().toISOString(),
                            model_version: "v2.1.0"
                        },
                        data: {
                            user_id: userId,
                            recommendations: Array.from({ length: k }).map((_, i) => ({
                                rank: i + 1,
                                item_id: `prod_${1000 + Math.floor(Math.random() * 9000)}`,
                                score: (0.98 - (i * 0.15) + (Math.random() * 0.05)).toFixed(4),
                                category: ["Electronics", "Home", "Fashion"][Math.floor(Math.random() * 3)]
                            }))
                        }
                    };
                    setResult(mockResponse);
                } catch (err) {
                    setError(err.message || String(err));
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                    {/* Input Section */}
                    <div className="grid grid-cols-1 md:grid-cols-12 gap-6 mb-8">
                        <div className="md:col-span-5">
                            <label className="block text-sm font-semibold text-gray-700 mb-2">User ID</label>
                            <div className="relative">
                                <input 
                                    value={userId} 
                                    onChange={e => setUserId(e.target.value)} 
                                    className="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none"
                                    placeholder="e.g. user-123"
                                />
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span className="text-gray-400 text-lg">@</span>
                                </div>
                            </div>
                        </div>

                        <div className="md:col-span-3">
                            <label className="block text-sm font-semibold text-gray-700 mb-2">Top-k Items</label>
                            <input 
                                type="number" 
                                value={k} 
                                onChange={e => setK(e.target.value)} 
                                min="1"
                                max="20"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none"
                            />
                        </div>

                        <div className="md:col-span-4 flex items-end">
                            <button 
                                onClick={callRecommend} 
                                disabled={loading}
                                className={`w-full py-3 px-6 rounded-lg font-medium text-white shadow-sm transition-all flex items-center justify-center gap-2
                                    ${loading 
                                        ? 'bg-indigo-400 cursor-not-allowed' 
                                        : 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-md active:transform active:scale-[0.98]'
                                    }`}
                            >
                                {loading ? (
                                    <span className="flex items-center gap-2">
                                        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                        Processing...
                                    </span>
                                ) : (
                                    <span className="flex items-center gap-2">
                                        <Server className="w-4 h-4" />
                                        Get Recommendations
                                    </span>
                                )}
                            </button>
                        </div>
                    </div>

                    {/* Error State */}
                    {error && (
                        <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-r flex items-start gap-3">
                            <AlertCircle className="text-red-500 w-5 h-5 mt-0.5" />
                            <div className="text-red-700 font-medium">Error connecting to recommendation engine: {error}</div>
                        </div>
                    )}

                    {/* Results State */}
                    {result && (
                        <div className="animate-in">
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                    <Database className="w-4 h-4 text-gray-500" />
                                    Response Data
                                </h3>
                                <span className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                    {result.meta.request_id}
                                </span>
                            </div>
                            
                            <div className="bg-slate-900 rounded-xl overflow-hidden shadow-inner">
                                <div className="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                                    <div className="flex gap-1.5">
                                        <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                        <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                        <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                    </div>
                                    <div className="ml-4 text-xs text-slate-400 font-mono">JSON Output</div>
                                </div>
                                <pre className="p-4 overflow-auto text-sm text-emerald-400 font-mono leading-relaxed max-h-[400px]">{JSON.stringify(result, null, 2)}</pre>
                            </div>
                        </div>
                    )}

                    {/* Empty State */}
                    {!result && !error && (
                        <div className="text-center py-12 bg-gray-50 rounded-xl border border-dashed border-gray-300">
                            <Activity className="w-12 h-12 text-gray-300 mx-auto mb-3" />
                            <p className="text-gray-500 font-medium">No results generated yet</p>
                            <p className="text-sm text-gray-400">Enter a User ID above and click Get Recommendations</p>
                        </div>
                    )}
                </div>
            );
        }

        function App() {
            return (
                <div className="min-h-screen bg-gray-50 p-6 font-sans text-slate-800">
                    <div className="max-w-4xl mx-auto">
                        <header className="mb-8 border-b pb-6">
                            <div className="flex items-center gap-3 mb-2">
                                <Activity className="text-indigo-600 w-8 h-8" />
                                <h1 className="text-3xl font-bold text-gray-900">RetargetIQ â€” Recommendations UI</h1>
                            </div>
                            <p className="text-gray-600 text-lg">
                                Call the recommend API and view results.
                                <span className="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    Docker Network Mode
                                </span>
                            </p>
                        </header>
                        <RecommendUI />
                    </div>
                </div>
            );
        }

        // --- Render ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
